# 数美天网-接口文档

## 具体接口

### 请求URL


| 集群 | URL                                               | 支持产品列表 |
| ---- | ------------------------------------------------- | ------------ |
| 北京 | `http://api-skynet-bj.fengkongcloud.com/v4/event` | 天网风险识别 |

### 请求方法

`POST`

### 字符编码

`UTF-8`

### 建议超时时间

1s

### 请求参数

请求body = 通用请求参数 +  事件特有参数 （放在data字段下）

#### 通用的请求参数

放在HTTP Body中，采用Json格式，具体参数如下：

| **参数名称** | **类型**    | **参数说明**                                                 | **是否必传** | **规范**                                                     |
| ------------ | ----------- | ------------------------------------------------------------ | ------------ | ------------------------------------------------------------ |
| accessKey    | string      | 接口认证密钥<br/>用于权限认证，开通账号服务时由数美提供或使用开通邮箱登录数美后台右上角相关文档处查看 | 必传参数     | 数美分配                                                     |
| appId        | string      | 应用ID，用于区分相同公司的不同应用                           | 必传参数     | 1. 该参数传递值可与数美协商<br>2. 当公司app存在多个马甲包，分下面两种情况:<br>马甲包账号互通，不同马甲包数据传入不同的appId，tokenId保持一致 <br>马甲包账号独立，不同马甲包数据传入不同的appId，tokenId必须不同 |
| eventId      | string      | 事件ID，用于标识事件类型。                                   | 必传参数     | 不同的事件对应不同的策略，不同的事件输入参数可能会有细微的差别，请对应按照各事件详细传参说明 |
| data         | json_object | 请求的数据内容                                               | 必传参数     | 请求的数据内容，最长10MB，[详见data参数](#data)              |

其中，data的内容如下：


| **参数名称** | **类型** | **参数说明**                                   | **是否必传**                 | **规范**                                                     |
| ------------ | -------- | ---------------------------------------------- | ---------------------------- | ------------------------------------------------------------ |
| tokenId      | string   | 用户唯一ID                                     | 必传参数                     | 1. tokenId传入业务系统中的用户ID，务必保证接入数美全部事件相同用户传入的用户ID值一致且唯一。<br />2. 如果公司主体下存在多个应用且需要按应用区分账号，即相同用户ID在不同应用中代表不同用户。则建议在传入的用户ID之前拼接应用标识作为tokenId传入，达到区分账号体系的目的。 <br />3. 如果没有区分需求，则直接将用户ID传入tokenId字段即可。 <br />4. 如果传入错误，会导致系统认为是不同账号，账号的行为无法关联，导致识别不准确。 |
| ip           | string   | 当前业务事件发生时的客户端公网ipv4地址         | 必传参数                     | 非内网ip                                                     |
| timestamp    | int64    | 当前业务事件发生时的时间戳，单位为毫秒（ms）   | 必传参数                     | 注意：时间戳为毫秒，13位整型                                 |
| deviceId     | string   | 数美设备指纹标识，由数美SDK生成                | 接入数美设备指纹，则必传参数 | 数美设备指纹标识，用于用户行为分析。<br/>注：<br/>1. 接入数美SDK前的版本，无法获取deviceId的情况下，deviceId传空" "即可<br/>2. 直接传输getDeviceId获取到的原始字段，不需要解密<br />3. 如果没有接入数美设备指纹，不传 |
| os           | string   | 应用端操作系统类型                             | 可选参数                     |                                                              |
| appVersion   | string   | 应用版本号                                     | 可选参数                     | 传入当前应用或服务正在使用的版本号，格式为3个点4段数字，每段数字最多4位，例如`3.2.1.1234`<br />不足4段的请补0，例如`2.1.5`传入`2.1.5.0`<br />多于4段的取前4段，例如`2.1.5.1.1`传入`2.1.5.1` |
| activityId   | string   | 营销活动id                                     | 可选参数                     | 建议传入对应营销活动标识id                                   |
| userAgent    | string   | 用户代理                                       | 可选参数                     |                                                              |
| countryCode  | string   | 手机用户的国家代码                             | 必传参数                     | 中国大陆区手机号填写`0086`<br />非中国大陆区手机号填写国家代码<br />例如：<br />美国填写`0001`、安道尔`0376`、巴哈马`1242` |
| phone        | string   | 手机号                                         | 必传参数                     | phone、phoneMd5、phoneSha256三者选一个，必传其一             |
| phoneMd5     | string   | 手机号的phoneMd5加密串                         | 必传参数                     | phone、phoneMd5、phoneSha256三者选一个，必传其一             |
| phoneSha256  | string   | 手机号的Sha256加密串                           | 必传参数                     | phone、phoneMd5、phoneSha256三者选一个，必传其一             |
| level        | int      | 用户等级，针对不同等级的用户可配置不同拦截策略 | 可选参数                     | 可选值：`0,1,2,3,4`分别对应：<br/>`0`：最低级用户，典型如新注册、完全不活跃或等级为0的用户等<br/>`1`：较低级用户，典型如低活跃或低等级用户等<br/>`2`：中等级用户，典型如具备一定活跃或等级中等的用户等<br/>`3`：较高级用户，典型如高活跃或高等级用户等<br/>`4`：最高级用户，典型如付费用户、VIP用户、可考虑放过的用户等 |
| vdata        | json     | 微行为数据传入字段                             | 可选参数                     |                                                              |
| extra        | json     | 用户自定义数据                                 | 可选参数                     | 如无必要，不传                                               |
| passThrough  | json     | 用户自定义透传字段                             | 可选参数                     | 如无必要，不传                                               |

### 返回结果

放在HTTP Body中，采用Json格式，具体参数如下：


| **参数名称**       | **类型**    | **参数说明**             | **是否必返** | **规范**                                                     |
| ------------------ | ----------- | ------------------------ | ------------ | ------------------------------------------------------------ |
| code               | int         | 返回码                   | 是           | `1100`：成功<br/>`1901`：QPS超限<br/>`1902`：参数不合法<br/>`1903`：服务失败<br/>`9101`：无权限操作<br/>除message和requestId之外的字段，只有当code为1100时才会存在 |
| message            | string      | 返回码描述               | 是           | 和code对应：`成功`,  `QPS超限`,  `参数不合法`,  `服务失败`,  `余额不足`,  `无权限操作` |
| requestId          | string      | 请求标识                 | 是           | 请求唯一标识，用于排查问题和后续效果优化，强烈建议保存       |
| riskLevel          | string      | 当前事件的处置可选参数   | 是           | `PASS`：通过<br/>`REVIEW`：审核<br/>`REJECT`：拒绝<br/>`VERIFY`：验证 |
| detail             | json_object | 风险详情信息，详情见下文 | 是           | 请见《detail结果详情》表                                     |
| tokenProfileLabels | json_array  | 账号属性标签             | 否           | 见下面详情内容，仅在服务开通时返回                           |
| tokenRiskLabels    | json_array  | 账号风险标签             | 否           | 见下面详情内容，仅在服务开通时返回                           |

其中

1）detail结果的详情内容


| **返回结果参数名** | **参数类型** | **参数说明**                             | **规范**                                                     |
| ------------------ | ------------ | ---------------------------------------- | ------------------------------------------------------------ |
| description        | string       | 当前事件的风险描述                       |                                                              |
| model              | string       | 规则标识，命中的最高优先级规则标识       |                                                              |
| hits               | json array   | 事件命中的所有规则标识                   | hits中每个字段都是一个object，详见`hits结果详情信息`         |
| ip_country         | string       | ip归属地国家                             |                                                              |
| ip_province        | string       | ip归属地省份                             |                                                              |
| ip_city            | string       | ip归属地城市                             |                                                              |
| verifyType         | string       | 当处置建议为`VERIFY`时，返回`verifyType` | `UPSMS`：上行短信验证码<br/>`DOWNSMS`：下行短信验证码<br/>`CAPTCHA`：验证码（点选或滑动等）<br/>`SEQUENCE`：语序验证（点选或输入）<br/>`SPATIAL`：空间逻辑推理<br/>`FACE`：人脸检测<br/>`DELAY`：延时交易 |

其中，hits结果详情的内容如下：


| **返回结果参数名** | **参数类型** | **参数说明**                             | **规范**                                                     |
| ------------------ | ------------ | ---------------------------------------- | ------------------------------------------------------------ |
| description        | string       | 当前事件的风险描述                       |                                                              |
| model              | string       | 规则标识                                 |                                                              |
| riskLevel          | string       | 当前事件的处置建议                       | `PASS`：通过<br/>`REVIEW`：审核<br/>`REJECT`：拒绝<br/>`VERIFY`：验证 |
| verifyType         | string       | 当处置建议为`VERIFY`时，返回`verifyType` | `UPSMS`：上行短信验证码<br/>`DOWNSMS`：下行短信验证码<br/>`CAPTCHA`：验证码（点选或滑动等）<br/>`SEQUENCE`：语序验证（点选或输入）<br/>`SPATIAL`：空间逻辑推理<br/>`FACE`：人脸检测<br/>`DELAY`：延时交易 |

其中标签类返回字段

1）tokenProfileLabels的详情内容


| **返回结果参数名** | **参数类型** | **参数说明**           | **规范**                     |
| ------------------ | ------------ | ---------------------- | ---------------------------- |
| label1             | string       | 一级标签               | 展示账号属性标签的一级标签。 |
| label2             | string       | 二级标签               | 展示账号属性标签的二级标签。 |
| label3             | string       | 三级标签               | 展示账号属性标签的三级标签。 |
| description        | string       | 风险描述               | 展示账号属性标签的中文描述。 |
| timestamp          | int64        | 最近一次命中策略的时间 | 最近一次命中策略的时间       |
| detail             | json_object  | 证据描述               | 证据细节                     |

2）tokenRiskLabels的详情内容


| **返回结果参数名** | **参数类型** | **参数说明**           | **规范**                     |
| ------------------ | ------------ | ---------------------- | ---------------------------- |
| label1             | string       | 一级标签               | 展示账号风险标签的一级标签。 |
| label2             | string       | 二级标签               | 展示账号风险标签的二级标签。 |
| label3             | string       | 三级标签               | 展示账号风险标签的三级标签。 |
| description        | string       | 风险描述               | 展示账号风险标签的中文描述。 |
| timestamp          | int64        | 最近一次命中策略的时间 | 最近一次命中策略的时间       |
| detail             | json_object  | 证据描述               | 证据细节                     |

## 事件列表

| **eventId**   | **事件名称** | **备注**                                                     |
| ------------- | ------------ | :----------------------------------------------------------- |
| airlineSearch | 查询航班     | 调用时机：用户输入始发地、目的地和时间后，点击查询按钮时调用 |

​           

## 事件详细API

#### 查询航班(airlineSearch)

| **参数名称**      | **类型**   | **参数说明**                       | **是否必传** | **规范**                               |
| ----------------- | ---------- | ---------------------------------- | ------------ | -------------------------------------- |
| [基础参数](#data) |            |                                    |              | 需要满足基础参数的配置要求             |
| startDate         | string     | 参数的内容                         | 必传字段     | 去程日期的值，格式类似：2019-01-01     |
| startCity         | string     | 参数的内容                         | 强烈建议     | 出发城市的名称或缩写                   |
| endCity           | string     | 参数的内容                         | 强烈建议     | 到达城市的名称或缩写                   |
| endDate           | string     | 参数的内容                         | 强烈建议     | 返程日期的值，格式类似：2019-01-01     |
| details           | json array | 查询航班的具体输入信息，详情见下文 | 强烈建议     | 查询多段航班时，其他输入信息传入该字段 |
| referId           | string     | 前一个内容或页面ID，可以是URI      | 强烈建议     |                                        |



details的内容如下：

| **参数名称** | **类型** | **参数说明** | **是否必传** | **规范**                           |
| ------------ | -------- | ------------ | ------------ | ---------------------------------- |
| startCity    | string   | 参数的内容   | 强烈建议     | 出发城市的名称或缩写               |
| endCity      | string   | 参数的内容   | 强烈建议     | 到达城市的名称或缩写               |
| startDate    | string   | 参数的内容   | 强烈建议     | 去程日期的值，格式类似：2019-01-01 |
| endDate      | string   | 参数的内容   | 强烈建议     | 返程日期的值，格式类似：2019-01-01 |

#### 

## 示例

### 请求示例

```json
{
  "accessKey": "xxxxxxxxxx",
  "appId": "default",
  "eventId": "register",
  "data": {
    "tokenId": "d64e481f93b158a7862a2c5571be9976",
    "timestamp": 1465810229852,
    "isSignupPlatformPhone": 0,
    "clickId": "3343",
    "phone": "978345D2958ED370761BB3C2A6D593DE",
    "type": "phoneOnePass",
    "signupPlatform": "weixin",
    "ip": "",
    "hashPassword": "eer3r3tegsegewgter",
    "isPhoneExist": 1,
    "nickName": "micky"
  }
}

```

### 同步返回示例

```json
{
  "requestId": "0acfaaebbc01001113d6ad0b8c11eeb8",
  "riskLevel": "REJECT",
  "tokenRiskLabels": [
    {
      "timestamp": 1652370941818,
      "label1": "risk_device_token",
      "label2": "multi_boxing_token",
      "label3": "multi_boxing_by_app_token",
      "description": "风险设备账号:多开设备账号:工具多开设备账号"
    },
    {
      "label1": "risk_device_token",
      "label2": "multi_boxing_apps_token",
      "label3": "multi_boxing_apps_token",
      "description": "风险设备账号:安装多开工具设备账号:安装多开工具设备账号",
      "timestamp": 1652370941818
    }
  ],
  "detail": {
    "ip_province": "江西",
    "hits": [
      {
        "description": "高风险账号:账号异常聚集账号",
        "model": "M002020112",
        "riskLevel": "REJECT"
      },
      {
        "description": "高风险账号:数美风险模型识别",
        "model": "M002070002",
        "riskLevel": "REJECT"
      },
      {
        "riskLevel": "REJECT",
        "description": "高风险账号:数美风险模型识别",
        "model": "M00212001"
      },
      {
        "description": "高风险设备:账号异常聚集",
        "model": "M99120102",
        "riskLevel": "REJECT"
      }
    ],
    "model": "M99120102",
    "machineAccountRisk": {
      "tokenSampleDesc": "账号异常聚集",
      "tokenSampleLastTs": 1652370941818
    },
    "description": "高风险设备:账号异常聚集",
    "ip_country": "中国",
    "ip_city": "上饶"
  },
  "code": 1100,
  "message": "成功"
}
```


